System.register(["jimu-core","jimu-arcgis","esri/layers/ImageryLayer","esri/geometry/Polygon","esri/symbols/SimpleFillSymbol","esri/layers/support/MosaicRule","calcite-components"],(function(e,t){var i={},a={},n={},c={},l={},o={},r={};return{setters:[function(e){i.React=e.React},function(e){a.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){c.default=e.default},function(e){l.default=e.default},function(e){o.default=e.default},function(e){r.CalciteAction=e.CalciteAction,r.CalciteActionBar=e.CalciteActionBar,r.CalciteBlock=e.CalciteBlock,r.CalciteChip=e.CalciteChip,r.CalciteFab=e.CalciteFab,r.CalciteLabel=e.CalciteLabel,r.CalcitePanel=e.CalcitePanel,r.CalciteShell=e.CalciteShell,r.CalciteSlider=e.CalciteSlider,r.CalciteSortableList=e.CalciteSortableList}],execute:function(){e((()=>{var e={145:e=>{"use strict";e.exports=r},19:e=>{"use strict";e.exports=c},55:e=>{"use strict";e.exports=n},163:e=>{"use strict";e.exports=o},565:e=>{"use strict";e.exports=l},826:e=>{"use strict";e.exports=a},891:e=>{"use strict";e.exports=i}},t={};function s(i){var a=t[i];if(void 0!==a)return a.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,s),n.exports}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),s.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.p="";var d={};return s.p=window.jimuConfig.baseUrl,(()=>{"use strict";s.r(d),s.d(d,{default:()=>g});var e=s(891),t=s(826),i=s(55),a=s(19),n=s(565),c=s(163),l=s(145);const{useState:o,useEffect:r}=e.React,u="OBJECTID",p="Map_Name",m="SHAPE",f="Imprint_Year",g=s=>{var d;const[g,C]=o(),[b,v]=o({where:"1=1",outFields:[[u,p,m,f].join(", ")],returnGeometry:!0,spatialRelationship:"intersects",orderByFields:[`${f} ASC`]}),[h,y]=o(),[E,x]=o([]),[R,j]=o(!1),w=new i.default({url:s.config.imageServiceUrl}),O=E.filter((e=>!0===e.pinned)).sort(((e,t)=>t.index-e.index)),S=E.filter((e=>e.pinned||!0===e.active)),A=E.filter((e=>!1===e.pinned));function k(e){console.log("handleListOrderChange");const t=[];e.target.childNodes.forEach((e=>t.push(Number(e.id))));const i=E.map((e=>t.includes(e.id)?Object.assign(Object.assign({},e),{index:t.length-1-t.indexOf(Number(e.id))}):e));x(i)}r((()=>(document.addEventListener("calciteListOrderChange",k),()=>{document.removeEventListener("calciteListOrderChange",k)})),[E]),r((()=>{if(g){const e=g.view.map.layers;S.forEach((t=>{if(!e.find((e=>e.id==t.id))){const e=new i.default({url:w.url,definitionExpression:`${u} = ${t.id}`,title:t.name,id:t.id.toString(),effect:"drop-shadow(5px, 5px, 5px)",mosaicRule:new c.default({method:"lock-raster",operation:"first"})});g.view.map.add(e)}})),e.forEach((e=>{const t=S.find((t=>t.id==e.id)),i=g.view.map.findLayerById(e.id);t?(t.index&&g.view.map.reorder(i,t.index),i.opacity!=t.opacity&&(i.opacity=t.opacity)):g.view.map.remove(i)}))}}),[E]),r((()=>{b.geometry&&M(25,0)}),[b]);let L=null;function M(e,t=0,i=!0){j(!0),console.log("fetchNewMaps"),w.queryRasterCount(b).then((e=>y(e))),w.queryRasters(Object.assign(Object.assign({},b),{start:t,num:e})).then((function(e){let t=[];i||(t=E.map((e=>e))),e.features.forEach((e=>{let i={id:e.getAttribute(u),name:e.getAttribute(p),feature:e,pinned:!1,active:!1,opacity:1};i.feature.symbol=new n.default;const a=E.find((e=>e.id===i.id)),c=Boolean(O.find((e=>e.id===i.id)));a&&!c?t.push(a):c||t.push(i)})),O.forEach((e=>{t.find((t=>t.id===e.id))||t.push(e)})),x(t),j(!1)}))}function B(e){g&&g.view.graphics.removeAll();const t=E.map((t=>t.id===e?Object.assign(Object.assign({},t),{pinned:!t.pinned,active:!t.pinned&&t.active,index:t.pinned?null:O.length}):Object.assign({},t)));x(t)}function P(t,i){return null==t?void 0:t.map((t=>e.React.createElement(l.CalciteBlock,{draggable:i,dragHandle:i,collapsible:!0,open:t.active,heading:`${t.id} ${t.name}`,description:[t.feature.getAttribute(f),t.active.toString(),t.pinned.toString(),null==t?void 0:t.index,null==t?void 0:t.opacity].join(" "),key:t.id,onCalciteBlockToggle:()=>function(e){const t=E.map((t=>t.id===e?Object.assign(Object.assign({},t),{active:!t.active}):Object.assign({},t)));x(t)}(t.id),onMouseEnter:()=>function(e){let t=E.find((t=>t.id===e));g&&g.view.graphics.add(t.feature)}(t.id),onMouseLeave:()=>{g&&g.view.graphics.removeAll()},style:{"margin-block":"0.1rem"},id:t.id},t.pinned?e.React.createElement(l.CalciteAction,{slot:"control",icon:"unpin",text:"Spara karta",onClick:()=>B(t.id)}):e.React.createElement(l.CalciteAction,{slot:"control",icon:"pushpin",text:"Ta bort karta",onClick:()=>B(t.id)}),e.React.createElement("div",{slot:"header-menu-actions"},e.React.createElement(l.CalciteAction,{"text-enabled":!0,icon:"zoom-to-object",text:"Visa på karta",onClick:()=>{var e;e=t.feature,g&&g.view.goTo(e),function(e){const t=E.map((t=>t.id===e?Object.assign(Object.assign({},t),{active:!0}):Object.assign({},t)));x(t)}(t.id)}})),e.React.createElement(l.CalciteLabel,null,"Kartans opacitet",e.React.createElement(l.CalciteSlider,{value:100*(null==t?void 0:t.opacity),"label-handles":!0,"label-ticks":!0,"max-label":"100","min-label":"0",ticks:100,snap:!0,scale:"s",onCalciteSliderChange:e=>function(e,t){const i=E.map((i=>i.id===t?Object.assign(Object.assign({},i),{opacity:e/100}):Object.assign({},i)));x(i),console.log("handleOpacity",e)}(e.target.value,t.id)})))))}const F=P(O,!0),I=P(A);return e.React.createElement("div",{className:"widget-starter jimu-widget"},e.React.createElement(l.CalciteShell,null,e.React.createElement(l.CalcitePanel,{loading:R},e.React.createElement(l.CalcitePanel,{heading:"Fastnålade kartor",style:{"block-size":"100%"}},e.React.createElement("div",{slot:"header-actions-end"},e.React.createElement(l.CalciteActionBar,{expandDisabled:!0,layout:"horizontal"},e.React.createElement(l.CalciteAction,{text:"Add"},e.React.createElement(l.CalciteChip,{value:"test",scale:"s"},O.length)))),e.React.createElement(l.CalciteSortableList,null,F||null)),e.React.createElement(l.CalcitePanel,{heading:"Historiska kartor"},e.React.createElement("div",{slot:"header-actions-end"},e.React.createElement(l.CalciteActionBar,{expandDisabled:!0,layout:"horizontal"},e.React.createElement(l.CalciteAction,{text:"Add"},e.React.createElement(l.CalciteChip,{value:"test",scale:"s"},h)))),e.React.createElement(l.CalciteSortableList,null,I||null,h>E.length?e.React.createElement(l.CalciteFab,{style:{margin:"0.5rem auto"},icon:"refresh",onClick:()=>M(25,E.length,!1)}):e.React.createElement(l.CalciteFab,{disabled:!0,style:{margin:"0.5rem auto"},icon:"refresh"}))))),s.useMapWidgetIds&&1===s.useMapWidgetIds.length&&e.React.createElement(t.JimuMapViewComponent,{useMapWidgetId:null===(d=s.useMapWidgetIds)||void 0===d?void 0:d[0],onActiveViewChange:function(e){e&&(C(e),e.view.watch("extent",(t=>{e.view.extent&&(L&&clearTimeout(L),L=setTimeout((()=>{const t=a.default.fromExtent(e.view.extent);v(Object.assign(Object.assign({},b),{geometry:t}))}),1e3))})))}}))}})(),d})())}}}));